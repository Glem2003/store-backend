"use strict";(self.webpackChunkstore_backend=self.webpackChunkstore_backend||[]).push([[966],{2596:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(267),n=a(6995);const o=e=>{const t=(0,r.A)();return{isMobile:(0,n.A)(t.breakpoints.down(e))}}},3200:(e,t,a)=>{a.d(t,{A:()=>n});var r=a(5043);const n=function(e){const[t,a]=(0,r.useState)(null),[n,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{(async()=>{o(!0),i(null);try{const t=await fetch("".concat(e));if(!t.ok)throw new Error("HTTP error ".concat(t.status));const r=await t.json();a(r)}catch(t){console.error("[useFetchData] ".concat(e),t),i(t.message)}finally{o(!1)}})()}),[e]),{data:t,loading:n,error:s}}},5966:(e,t,a)=>{a.r(t),a.d(t,{default:()=>I});var r=a(9379),n=a(3969),o=a(3089),s=a(5895),i=a(6154),l=a(2419),d=a(9598),c=a(1859),u=a(7873),h=a(8470),g=a(4961),m=a(2596),p=a(579);const A=e=>{const{t:t}=(0,g.B)(),{isMobile:a}=(0,m.A)("sm"),{value:r,onChange:o}=e;return(0,p.jsxs)(n.A,{display:"flex",flexDirection:a?"row":"column",alignItems:"center",gap:2,children:[(0,p.jsx)(u.A,{variant:"rounded",src:r||"",sx:{minWidth:a?60:120,height:a?60:120,border:"1px solid #ccc"}}),(0,p.jsx)("input",{accept:"image/*",id:"upload-image",type:"file",style:{display:"none"},onChange:o}),(0,p.jsx)("label",{htmlFor:"upload-image",children:(0,p.jsx)(c.A,{variant:"contained",color:"primary",component:"span",startIcon:(0,p.jsx)(h.A,{}),size:a?"small":"medium",children:t("select_image")})})]})};var x=a(6592),y=a(3971),f=a(5847),v=a(5030);const b=e=>{const{t:t}=(0,g.B)(),{label:a,isActive:r,onChange:n}=e;return(0,p.jsxs)(x.A,{component:"fieldset",sx:{border:"1px solid gray",p:1,borderRadius:1,minWidth:150},children:[(0,p.jsx)(y.A,{component:"legend",children:t(a)}),(0,p.jsx)(f.A,{control:(0,p.jsx)(v.A,{checked:r,onChange:e=>n(e.target.checked)}),label:t(r?"active":"disabled"),labelPlacement:"start"})]})};var j=a(4858),w=a(5043),_=a(3260),C=a(8959);const k=async e=>{const t=new FormData;t.append("file",e),t.append("upload_preset","store_backend");const a=await fetch(C.mx,{method:"POST",body:t});if(!a.ok)throw new Error("Images upload fail");return(await a.json()).secure_url};var q=a(6297);const S=()=>{const{data:e,error:t,loading:a}=(0,q.A)(),{t:n}=(0,g.B)(),{register:o,reset:s,setValue:i,watch:l,control:d,trigger:c,setError:u,formState:{errors:h}}=(0,j.mN)({mode:"onBlur",defaultValues:{id:"",name:"",price:0,qty:0,mainCategory:"",subCategory:"",status:!1,images:null}}),m=(0,_.Zp)(),p=l("id"),A=l("name"),x=l("price"),y=l("qty"),f=l("status"),v=l("mainCategory"),b=l("subCategory"),S=l("images"),[E,I]=(0,w.useState)({}),[z,D]=(0,w.useState)(null),T=(0,w.useCallback)((async e=>{try{var t;const a=await fetch("".concat(C.Ee,"/").concat(e));if(!a.ok)throw new Error("Https Error");const r=await a.json();if(!r)return;const n={id:r.id,name:r.name,price:Number(r.price),qty:Number(r.qty),mainCategory:r.mainCategory||"",subCategory:r.subCategory||"",status:null!==(t=r.status)&&void 0!==t&&t,images:r.images||""};s(n),r.images&&i("images",r.images)}catch(a){console.error(a)}}),[s,i]);return(0,w.useEffect)((()=>{if(!Array.isArray(e))return;const t=(e=>{const t={};for(const{mainCategory:r,subCategory:n}of e)r&&n&&(t[r]||(t[r]=new Set),t[r].add(n));const a={};for(const[r,n]of Object.entries(t))a[r]=Array.from(n);return a})(e);I((e=>JSON.stringify(e)===JSON.stringify(t)?e:t))}),[e]),{register:o,setValue:i,reset:s,control:d,errors:h,watchedSKU:p,watchName:A,watchedPrice:x,watchedQty:y,watchedStatus:f,watchedMainCategory:v,watchedSubCategory:b,watchedImages:S,categoryOptions:E,imageFile:z,error:t,loading:a,setImagesFile:D,getFormDataFromId:T,handleMainCategoryChange:e=>{I((t=>t[e]?t:(0,r.A)((0,r.A)({},t),{},{[e]:[]})))},handleImageChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;const r=new FileReader;if(r.onload=()=>{const e=r.result;i("images",e),D(a)},r.onerror=e=>{console.log("FileReader error:",e)},r.readAsDataURL(a),a){D(a);const e=new FileReader;e.onload=()=>{i("images",e.result)},e.readAsDataURL(a)}},handleAdd:async()=>{if(!await c())return void console.warn("\u8868\u55ae\u9a57\u8b49\u5931\u6557\uff0c\u505c\u6b62\u5132\u5b58");const e=await fetch(C.Ee),a=await e.json(),r=l("id");if(a.some((e=>e.id===r)))return void u("id",{type:"manual",message:n("sku_already_exists")});let o=l("images");!t&&z&&(o=await k(z));const i={id:p,name:A,price:x,qty:y,mainCategory:v,subCategory:b,status:f,images:o,updatedAt:new Date};await fetch(C.Ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),console.log(i),alert("\u65b0\u589e\u6210\u529f"),m("/backend/products"),s(),D(null)},handleSave:async()=>{if(!await c())return void console.warn("\u8868\u55ae\u9a57\u8b49\u5931\u6557\uff0c\u505c\u6b62\u5132\u5b58");let e=l("images");!t&&z&&(e=await k(z));const a={id:p,name:A,price:x,qty:y,mainCategory:v,subCategory:b,status:f,images:e,updatedAt:new Date};await fetch("".concat(C.Ee,"/").concat(p),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),console.log(a),alert("\u6210\u529f"),m("/backend/products")},handleReset:()=>{s(),D(null)},handleDelete:async()=>{if(p)try{if(!window.confirm(n("are_you_sure_you_want_to_delete_this_data")))return;if(!(await fetch("".concat(C.Ee,"/").concat(p),{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("\u522a\u9664\u5931\u6557");alert("SKU: ".concat(p," \u5df2\u522a\u9664")),m("/backend/products"),s(),D(null)}catch(e){console.log(e)}}}},E={product:{add:{title:"add_product"},edit:{title:"edit_product"}},order:{add:{title:""},edit:{title:""}},customers:{add:{title:""},edit:{title:""}}},I=e=>{var t,a,u;const{mode:h,resource:x}=e,{id:y}=(0,_.g)(),f=null===(t=E[x])||void 0===t?void 0:t[h],{isMobile:v}=(0,m.A)("md"),{t:C}=(0,g.B)(),k=(0,_.Zp)(),{register:q,errors:I,control:z,watchedMainCategory:D,watchedImages:T,categoryOptions:F,handleReset:O,handleAdd:N,handleSave:R,handleDelete:U,getFormDataFromId:W,handleImageChange:M}=S(),P=Object.keys(F);return(0,w.useEffect)((()=>{y&&W(y)}),[y,W]),(0,p.jsx)(n.A,{component:"form",sx:{p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:2,height:"calc( 100vh - 140px )"},children:(0,p.jsxs)(o.A,{container:!0,size:12,height:"100%",children:[(0,p.jsx)(o.A,{size:12,children:(0,p.jsx)(s.A,{variant:"h5",mb:2,fontWeight:600,children:C(f.title)})}),(0,p.jsxs)(o.A,{container:!0,spacing:3,sx:{overflowY:"auto",height:"calc( 100% - 140px )"},children:[(0,p.jsx)(o.A,{size:{xs:12,md:8},pt:1,children:(0,p.jsxs)(o.A,{container:!0,spacing:2,children:[(0,p.jsx)(o.A,{size:{xs:12},children:(0,p.jsx)(j.xI,{name:"id",control:z,rules:{required:C("this_field_is_required")},render:e=>{var t;let{field:a}=e;return(0,p.jsx)(i.A,(0,r.A)((0,r.A)({},a),{},{fullWidth:!0,variant:"outlined",label:"SKU",required:!0,error:!!I.id,helperText:null===(t=I.id)||void 0===t?void 0:t.message,placeholder:C("input_product_serial_number"),slotProps:{input:{readOnly:"edit"===h}}}))}})}),(0,p.jsx)(o.A,{size:{xs:12},children:(0,p.jsx)(j.xI,{name:"name",control:z,rules:{required:C("this_field_is_required")},render:e=>{var t;let{field:a}=e;return(0,p.jsx)(i.A,(0,r.A)((0,r.A)({},a),{},{fullWidth:!0,variant:"outlined",label:C("product_name"),required:!0,error:!!I.name,helperText:null===(t=I.name)||void 0===t?void 0:t.message}))}})}),(0,p.jsx)(o.A,{size:{xs:12,md:6},children:(0,p.jsx)(i.A,(0,r.A)((0,r.A)({fullWidth:!0,variant:"outlined",label:C("price"),id:"price",type:"number",required:!0},q("price",{required:C("this_field_is_required"),valueAsNumber:!0,min:{value:0,message:C("price_cannot_be_less_than_0")}})),{},{error:!!I.price,helperText:null===(a=I.price)||void 0===a?void 0:a.message}))}),(0,p.jsx)(o.A,{size:{xs:12,md:6},children:(0,p.jsx)(i.A,(0,r.A)((0,r.A)({fullWidth:!0,variant:"outlined",label:C("quantity"),id:"qty",type:"number",required:!0},q("qty",{required:C("this_field_is_required"),valueAsNumber:!0,min:{value:0,message:C("price_cannot_be_less_than_0")}})),{},{error:!!I.qty,helperText:null===(u=I.qty)||void 0===u?void 0:u.message}))}),(0,p.jsxs)(o.A,{container:!0,size:{xs:12},children:[(0,p.jsx)(o.A,{size:6,children:(0,p.jsx)(j.xI,{name:"mainCategory",control:z,render:e=>{let{field:t}=e;return(0,p.jsx)(l.A,{freeSolo:!0,options:P,value:t.value,onInputChange:(e,a)=>t.onChange(a),onChange:(e,a)=>t.onChange(a||""),renderInput:e=>(0,p.jsx)(i.A,(0,r.A)((0,r.A)({},e),{},{label:C("product_category"),variant:"outlined",placeholder:C("input_or_select_category")}))})}})}),(0,p.jsx)(o.A,{size:6,children:(0,p.jsx)(j.xI,{name:"subCategory",control:z,render:e=>{let{field:t}=e;return(0,p.jsx)(l.A,{freeSolo:!0,value:t.value,options:Array.isArray(F[D])?F[D]:[],disabled:!D,onInputChange:(e,a)=>t.onChange(a),onChange:(e,a)=>t.onChange(a||""),renderInput:e=>(0,p.jsx)(i.A,(0,r.A)((0,r.A)({},e),{},{label:C("subcategory"),variant:"outlined",placeholder:C("input_or_select_subcategory")}))})}})})]})]})}),(0,p.jsxs)(o.A,{container:!0,size:{xs:12,md:4},display:v?"flex":"grid",gap:v?1:4,pb:1,sx:{placeContent:v?"space-between":"center"},children:[(0,p.jsx)(o.A,{order:v?2:1,children:(0,p.jsx)(j.xI,{name:"images",control:z,render:()=>(0,p.jsx)(A,{value:T,onChange:M})})}),(0,p.jsx)(o.A,{order:v?1:2,children:(0,p.jsx)(j.xI,{name:"status",control:z,render:e=>{let{field:t}=e;return(0,p.jsx)(b,{label:"product_status",isActive:t.value,onChange:t.onChange})}})})]})]}),(0,p.jsx)(o.A,{size:12,children:(0,p.jsxs)(n.A,{mt:4,display:"flex",justifyContent:"center",gap:2,children:[(0,p.jsxs)(d.A,{variant:"outlined",children:[(0,p.jsx)(c.A,{onClick:"add"===h?N:R,children:C("add"===h?"add":"save")}),(0,p.jsx)(c.A,{onClick:O,children:C("reset")}),"edit"===h&&(0,p.jsx)(c.A,{color:"error",onClick:U,children:C("delete")})]}),(0,p.jsx)(c.A,{variant:"contained",color:"error",onClick:()=>k("/backend/products"),children:C("cancel")})]})})]})})}},6297:(e,t,a)=>{a.d(t,{A:()=>l});var r=a(9379),n=a(45),o=a(3200),s=a(8959);const i=["data"],l=()=>{var e;const t=(0,o.A)(s.Ee),{data:a}=t,l=(0,n.A)(t,i),{error:d,loading:c}=(0,o.A)(s.Ee),u=null!==(e=null===a||void 0===a?void 0:a.map((e=>(0,r.A)((0,r.A)({},e),{},{updatedAt:new Date(e.updatedAt)}))))&&void 0!==e?e:[];return(0,r.A)((0,r.A)({data:u},l),{},{error:d,loading:c})}},8959:(e,t,a)=>{a.d(t,{Ee:()=>l,UH:()=>n,Us:()=>s,cA:()=>i,jk:()=>o,mx:()=>d});const r="https://store-mock-api.onrender.com",n="".concat(r,"/summary"),o="".concat(r,"/salesWeekly"),s="".concat(r,"/saleMonth"),i="".concat(r,"/saleYearly"),l="".concat(r,"/products"),d="https://api.cloudinary.com/v1_1/ddzpuxyjr/image/upload"}}]);
//# sourceMappingURL=966.ec02b2d4.chunk.js.map